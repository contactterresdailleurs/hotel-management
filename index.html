<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion H√¥teli√®re</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const Hotel = () => <svg className="w-10 h-10 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg>;
        const Mail = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>;
        const Plus = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg>;
        const Send = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg>;
        const Star = ({ className }) => <svg className={className} fill="currentColor" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" /></svg>;
        const Trash2 = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>;
        const Building2 = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg>;
        const Copy = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>;
        const Check = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /></svg>;
        const X = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>;
        const Edit = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>;
        const Search = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>;
        const Download = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>;
        const Upload = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L9 8m4-4v12" /></svg>;

        function App() {
          const [hotels, setHotels] = useState([]);
          const [showAddForm, setShowAddForm] = useState(false);
          const [showRequestForm, setShowRequestForm] = useState(false);
          const [showEmailsModal, setShowEmailsModal] = useState(false);
          const [generatedEmails, setGeneratedEmails] = useState([]);
          const [copiedIndex, setCopiedIndex] = useState(null);
          const [editingHotel, setEditingHotel] = useState(null);
          const [searchTerm, setSearchTerm] = useState('');
          
          const [newHotel, setNewHotel] = useState({
            name: '', city: '', email: '', stars: 3, notes: ''
          });

          const [bookingRequest, setBookingRequest] = useState({
            city: '', checkIn: '', checkOut: '', totalPersons: '', single: '', doubleTwin: '', triple: '', family: ''
          });

          useEffect(() => {
            const saved = localStorage.getItem('hotels-db');
            if (saved) {
              try { setHotels(JSON.parse(saved)); } catch (e) {}
            }
          }, []);

          useEffect(() => {
            if (hotels.length > 0) {
              localStorage.setItem('hotels-db', JSON.stringify(hotels));
            }
          }, [hotels]);

          const addHotel = () => {
            if (newHotel.name && newHotel.city && newHotel.email) {
              setHotels([...hotels, { ...newHotel, id: Date.now() }]);
              setNewHotel({ name: '', city: '', email: '', stars: 3, notes: '' });
              setShowAddForm(false);
            }
          };

          const deleteHotel = (id) => setHotels(hotels.filter(h => h.id !== id));

          const startEdit = (hotel) => {
            setEditingHotel(hotel);
            setNewHotel({ name: hotel.name, city: hotel.city, email: hotel.email, stars: hotel.stars, notes: hotel.notes || '' });
            setShowAddForm(true);
          };

          const updateHotel = () => {
            if (newHotel.name && newHotel.city && newHotel.email) {
              setHotels(hotels.map(h => h.id === editingHotel.id ? { ...newHotel, id: editingHotel.id } : h));
              setNewHotel({ name: '', city: '', email: '', stars: 3, notes: '' });
              setEditingHotel(null);
              setShowAddForm(false);
            }
          };

          const cancelEdit = () => {
            setEditingHotel(null);
            setNewHotel({ name: '', city: '', email: '', stars: 3, notes: '' });
            setShowAddForm(false);
          };

          const exportDB = () => {
            const blob = new Blob([JSON.stringify(hotels, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `hotels-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
          };

          const importDB = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
              try {
                const data = JSON.parse(ev.target.result);
                if (Array.isArray(data)) {
                  if (window.confirm(`Importer ${data.length} h√¥tel(s) ? Cela remplacera vos ${hotels.length} h√¥tel(s) actuels.`)) {
                    setHotels(data);
                    alert(`‚úÖ ${data.length} h√¥tel(s) import√©s !`);
                  }
                }
              } catch (err) { alert('‚ùå Fichier invalide'); }
            };
            reader.readAsText(file);
            e.target.value = '';
          };

          const cities = [...new Set(hotels.map(h => h.city))].sort();
          const filteredHotels = hotels.filter(h => {
            const s = searchTerm.toLowerCase();
            return h.name.toLowerCase().includes(s) || h.city.toLowerCase().includes(s);
          });

          const genEmail = () => {
            const rooms = [];
            if (bookingRequest.single) rooms.push(`${bookingRequest.single} Single room(s)`);
            if (bookingRequest.doubleTwin) rooms.push(`${bookingRequest.doubleTwin} Double/Twin room(s)`);
            if (bookingRequest.triple) rooms.push(`${bookingRequest.triple} Triple room(s)`);
            if (bookingRequest.family) rooms.push(`${bookingRequest.family} Family room(s)`);
            return `Hi,\n\nWe are looking for availability for a group of ${bookingRequest.totalPersons} person(s).\n\nRequested dates:\n- Check-in: ${new Date(bookingRequest.checkIn).toLocaleDateString('en-GB')}\n- Check-out: ${new Date(bookingRequest.checkOut).toLocaleDateString('en-GB')}\n\nRooms required:\n${rooms.join('\n')}\n\nCould you please confirm:\n1. Room availability for these dates\n2. Your rates (breakfast included)\n3. Your booking conditions\n\nWe remain at your disposal for any further information.\n\nBest regards`;
          };

          const generateEmails = () => {
            const list = hotels.filter(h => h.city === bookingRequest.city);
            if (list.length === 0) { alert('Aucun h√¥tel dans cette ville'); return; }
            const emails = list.map(h => ({ hotel: h, subject: `Availability request group ${bookingRequest.totalPersons} pax`, body: genEmail() }));
            setGeneratedEmails(emails);
            setShowEmailsModal(true);
          };

          const copyText = (txt, idx) => {
            navigator.clipboard.writeText(txt).then(() => {
              setCopiedIndex(idx);
              setTimeout(() => setCopiedIndex(null), 2000);
            });
          };

          const openEmail = (email) => {
            window.location.href = `mailto:${email.hotel.email}?subject=${encodeURIComponent(email.subject)}&body=${encodeURIComponent(email.body)}`;
          };

          const openAll = () => {
            if (generatedEmails.length === 0) return;
            openEmail(generatedEmails[0]);
            generatedEmails.slice(1).forEach((em, i) => {
              setTimeout(() => openEmail(em), (i + 1) * 1000);
            });
            alert(`${generatedEmails.length} emails vont s'ouvrir`);
          };

          const canSend = bookingRequest.city && bookingRequest.checkIn && bookingRequest.checkOut && bookingRequest.totalPersons && (bookingRequest.single || bookingRequest.doubleTwin || bookingRequest.triple || bookingRequest.family);

          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
              <div className="max-w-6xl mx-auto">
                <div className="bg-white rounded-2xl shadow-xl p-8">
                  <div className="flex items-center gap-3 mb-6">
                    <Hotel />
                    <h1 className="text-3xl font-bold text-gray-800">Gestion H√¥teli√®re</h1>
                  </div>

                  <div className="bg-amber-50 border-2 border-amber-400 rounded-xl p-5 mb-8">
                    <h3 className="text-lg font-bold text-amber-900 mb-3">üíæ Sauvegarde & Partage</h3>
                    <div className="flex flex-wrap gap-3 mb-3">
                      <button onClick={exportDB} disabled={hotels.length === 0} className="bg-amber-600 hover:bg-amber-700 disabled:bg-gray-300 text-white px-5 py-3 rounded-lg flex items-center gap-2 font-semibold">
                        <Download className="w-5 h-5" />T√©l√©charger la base
                      </button>
                      <label className="bg-blue-600 hover:bg-blue-700 text-white px-5 py-3 rounded-lg flex items-center gap-2 cursor-pointer font-semibold">
                        <Upload className="w-5 h-5" />Importer
                        <input type="file" accept=".json" onChange={importDB} className="hidden" />
                      </label>
                    </div>
                    <p className="text-sm text-amber-900">‚ÑπÔ∏è Sauvegardez et partagez avec vos collaborateurs</p>
                  </div>

                  <div className="grid md:grid-cols-2 gap-6 mb-8">
                    <button onClick={() => setShowAddForm(!showAddForm)} className="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg flex items-center justify-center gap-2">
                      <Plus className="w-5 h-5" />Ajouter un h√¥tel
                    </button>
                    <button onClick={() => setShowRequestForm(!showRequestForm)} disabled={hotels.length === 0} className="bg-green-600 hover:bg-green-700 disabled:bg-gray-300 text-white px-6 py-3 rounded-lg flex items-center justify-center gap-2">
                      <Send className="w-5 h-5" />Nouvelle demande
                    </button>
                  </div>

                  {showAddForm && (
                    <div className="bg-blue-50 p-6 rounded-xl mb-8">
                      <h2 className="text-xl font-semibold mb-4">{editingHotel ? 'Modifier' : 'Nouvel h√¥tel'}</h2>
                      <div className="grid md:grid-cols-2 gap-4">
                        <input type="text" placeholder="Nom" value={newHotel.name} onChange={(e) => setNewHotel({...newHotel, name: e.target.value})} className="px-4 py-2 rounded-lg border focus:ring-2 focus:ring-indigo-500 outline-none" />
                        <input type="text" placeholder="Ville" value={newHotel.city} onChange={(e) => setNewHotel({...newHotel, city: e.target.value})} className="px-4 py-2 rounded-lg border focus:ring-2 focus:ring-indigo-500 outline-none" />
                        <input type="email" placeholder="Email" value={newHotel.email} onChange={(e) => setNewHotel({...newHotel, email: e.target.value})} className="px-4 py-2 rounded-lg border focus:ring-2 focus:ring-indigo-500 outline-none" />
                        <select value={newHotel.stars} onChange={(e) => setNewHotel({...newHotel, stars: parseInt(e.target.value)})} className="px-4 py-2 rounded-lg border focus:ring-2 focus:ring-indigo-500 outline-none">
                          {[1,2,3,4,5].map(n => <option key={n} value={n}>{n} ‚≠ê</option>)}
                        </select>
                        <textarea placeholder="Notes" value={newHotel.notes} onChange={(e) => setNewHotel({...newHotel, notes: e.target.value})} className="md:col-span-2 px-4 py-2 rounded-lg border focus:ring-2 focus:ring-indigo-500 outline-none" rows="3" />
                      </div>
                      <div className="flex gap-3 mt-4">
                        <button onClick={editingHotel ? updateHotel : addHotel} className="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg">
                          {editingHotel ? 'Mettre √† jour' : 'Enregistrer'}
                        </button>
                        {editingHotel && <button onClick={cancelEdit} className="bg-gray-400 hover:bg-gray-500 text-white px-6 py-2 rounded-lg">Annuler</button>}
                      </div>
                    </div>
                  )}

                  {showRequestForm && (
                    <div className="bg-green-50 p-6 rounded-xl mb-8">
                      <h2 className="text-xl font-semibold mb-4">Demande de disponibilit√©</h2>
                      <div className="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                          <label className="block text-sm font-medium mb-1">Ville</label>
                          <select value={bookingRequest.city} onChange={(e) => setBookingRequest({...bookingRequest, city: e.target.value})} className="w-full px-4 py-2 rounded-lg border focus:ring-2 focus:ring-green-500 outline-none">
                            <option value="">S√©lectionner</option>
                            {cities.map(c => <option key={c} value={c}>{c}</option>)}
                          </select>
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Personnes (pax)</label>
                          <input type="number" min="1" value={bookingRequest.totalPersons} onChange={(e) => setBookingRequest({...bookingRequest, totalPersons: e.target.value})} className="w-full px-4 py-2 rounded-lg border focus:ring-2 focus:ring-green-500 outline-none" />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Arriv√©e</label>
                          <input type="date" value={bookingRequest.checkIn} onChange={(e) => setBookingRequest({...bookingRequest, checkIn: e.target.value})} className="w-full px-4 py-2 rounded-lg border focus:ring-2 focus:ring-green-500 outline-none" />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">D√©part</label>
                          <input type="date" value={bookingRequest.checkOut} onChange={(e) => setBookingRequest({...bookingRequest, checkOut: e.target.value})} className="w-full px-4 py-2 rounded-lg border focus:ring-2 focus:ring-green-500 outline-none" />
                        </div>
                      </div>
                      <h3 className="font-semibold mb-3">Chambres</h3>
                      <div className="grid md:grid-cols-4 gap-4 mb-4">
                        <div><label className="block text-sm mb-1">Single</label><input type="number" min="0" value={bookingRequest.single} onChange={(e) => setBookingRequest({...bookingRequest, single: e.target.value})} className="w-full px-4 py-2 rounded-lg border focus:ring-2 focus:ring-green-500 outline-none" /></div>
                        <div><label className="block text-sm mb-1">Double/Twin</label><input type="number" min="0" value={bookingRequest.doubleTwin} onChange={(e) => setBookingRequest({...bookingRequest, doubleTwin: e.target.value})} className="w-full px-4 py-2 rounded-lg border focus:ring-2 focus:ring-green-500 outline-none" /></div>
                        <div><label className="block text-sm mb-1">Triple</label><input type="number" min="0" value={bookingRequest.triple} onChange={(e) => setBookingRequest({...bookingRequest, triple: e.target.value})} className="w-full px-4 py-2 rounded-lg border focus:ring-2 focus:ring-green-500 outline-none" /></div>
                        <div><label className="block text-sm mb-1">Familiale</label><input type="number" min="0" value={bookingRequest.family} onChange={(e) => setBookingRequest({...bookingRequest, family: e.target.value})} className="w-full px-4 py-2 rounded-lg border focus:ring-2 focus:ring-green-500 outline-none" /></div>
                      </div>
                      <button onClick={generateEmails} disabled={!canSend} className={`px-6 py-3 rounded-lg flex items-center gap-2 ${canSend ? 'bg-green-600 hover:bg-green-700 text-white' : 'bg-gray-300 text-gray-500'}`}>
                        <Send className="w-5 h-5" />G√©n√©rer
                      </button>
                    </div>
                  )}

                  <div className="mt-8">
                    <h2 className="text-2xl font-semibold mb-4 flex items-center gap-2">
                      <Building2 className="w-6 h-6" />Base de donn√©es ({hotels.length})
                    </h2>
                    <div className="mb-6 relative">
                      <input type="text" placeholder="Rechercher..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className="w-full px-4 py-3 pl-12 rounded-lg border focus:ring-2 focus:ring-indigo-500 outline-none" />
                      <Search className="absolute left-4 top-3.5 w-5 h-5 text-gray-400" />
                      {searchTerm && <p className="text-sm text-gray-600 mt-2">{filteredHotels.length} r√©sultat(s)</p>}
                    </div>

                    {hotels.length === 0 ? (
                      <div className="text-center py-12 text-gray-500"><Hotel /><p className="mt-4">Aucun h√¥tel</p></div>
                    ) : filteredHotels.length === 0 ? (
                      <div className="text-center py-12 text-gray-500"><Search className="w-16 h-16 mx-auto mb-4 opacity-30" /><p>Aucun r√©sultat</p></div>
                    ) : (
                      <div className="grid gap-4">
                        {filteredHotels.map(h => (
                          <div key={h.id} className="bg-gray-50 p-4 rounded-lg flex justify-between hover:bg-gray-100">
                            <div className="flex-1">
                              <div className="flex items-center gap-3 mb-2">
                                <h3 className="font-semibold text-lg">{h.name}</h3>
                                <div className="flex gap-1">{[...Array(h.stars)].map((_, i) => <Star key={i} className="w-4 h-4 fill-yellow-400 text-yellow-400" />)}</div>
                              </div>
                              <div className="flex gap-4 text-sm text-gray-600 mb-2">
                                <span className="flex items-center gap-1"><Building2 className="w-4 h-4" />{h.city}</span>
                                <span className="flex items-center gap-1"><Mail className="w-4 h-4" />{h.email}</span>
                              </div>
                              {h.notes && <p className="text-sm text-gray-500 italic">üìù {h.notes}</p>}
                            </div>
                            <div className="flex gap-2">
                              <button onClick={() => startEdit(h)} className="text-blue-500 hover:text-blue-700 p-2 hover:bg-blue-50 rounded-lg"><Edit className="w-5 h-5" /></button>
                              <button onClick={() => deleteHotel(h.id)} className="text-red-500 hover:text-red-700 p-2 hover:bg-red-50 rounded-lg"><Trash2 className="w-5 h-5" /></button>
                            </div>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                </div>
              </div>

              {showEmailsModal && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                  <div className="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col">
                    <div className="p-6 border-b flex items-center justify-between">
                      <h2 className="text-2xl font-bold">Emails - {bookingRequest.totalPersons} pax ({generatedEmails.length})</h2>
                      <button onClick={() => setShowEmailsModal(false)} className="text-gray-500 hover:text-gray-700 p-2 hover:bg-gray-100 rounded-lg"><X className="w-6 h-6" /></button>
                    </div>
                    <div className="p-6 border-b bg-purple-50">
                      <button onClick={openAll} className="w-full bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg flex items-center justify-center gap-2 font-semibold text-lg">
                        <Send className="w-6 h-6" />Ouvrir tous ({generatedEmails.length})
                      </button>
                      <p className="text-sm text-gray-600 text-center mt-3">Un par seconde</p>
                    </div>
                    <div className="overflow-y-auto p-6 space-y-6">
                      {generatedEmails.map((em, i) => (
                        <div key={i} className="bg-gray-50 rounded-xl p-5 border">
                          <div className="flex justify-between mb-4">
                            <div>
                              <h3 className="font-semibold text-lg mb-1">{em.hotel.name}</h3>
                              <p className